<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Edge AI demo</title>
    <link rel="stylesheet" type="text/css" href="./main.css">
</head>

<body>
    <h1>Edge AI demo</h1>

    <br>
    <h3>Inference result</h3>
    <div id="app">
        Device Name: {{device_name}}<br>
        Time stamp: {{timestamp}}<br>
    Class label: [#{{cnt}}] {{message}}
    </div>

    <script src="https://jp.vuejs.org/js/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
    <script src="./uuid.js"></script>
    <script>
    var app = new Vue({
        el: '#app',
        data: {
            device_name: '',
            timestamp: '',
            message: '',
            cnt: 0
        }
    });
    </script>

    <script>
    //const host = 'localhost'
    const host = window.location.hostname
    console.log(host)
    const port = 11883  // MQTT over WebSocket
    const topic = 'sensor'

    let cnt = 0;

    function onConnect() {
        console.log('connected');
        mqtt.subscribe(topic);
    }
    function onMessageArrived(msg) {
        data = msg.payloadString;
        console.log(data);
        data = data.split(',')
        app.device_name = data[0];
        app.timestamp = data[1];
        app.message = data[2];
        cnt = cnt + 1;
        app.cnt = cnt;
    }
    function connect() {
        mqtt = new Paho.MQTT.Client(host, port, uuidv4());
        let options = {
            timeout: 3,
            onSuccess: onConnect,
        };
        mqtt.onMessageArrived = onMessageArrived
        mqtt.connect(options);
        console.log('connecting...');
    }
    </script>

    <script>
    connect();
    </script>
</body>
</html>
